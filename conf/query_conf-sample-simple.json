{
  "queryModels": [
    {
      "name": "stage",
      "type": "pie",
      "params": {
        "required": [
          {
            "name": "byo"
          }
        ]
      },
      "query" : {
        "sql": "SELECT stage, COUNT(*) FROM re_~@byo@~_front.re_fsbo GROUP BY stage"
      },
      "data": {
        "title": "column.0",
        "dataset": [
          {
            "name": "# of Ads",
            "from": "column.1"
          }
        ]
      }
    },

    {
      "name": "funnel",
      "type": "line",
      "params": {
        "required": [
          {
            "name": "byo"
          }
        ]
      },
      "query": {
        "sql": "SELECT (SELECT COUNT(*) FROM re_~@byo@~_front.re_fsbo WHERE re_~@byo@~_front.re_fsbo.latestExtractionDate > CURDATE()) AS frontendTotalCount, (SELECT COUNT(*) FROM re_~@byo@~_front.re_fsbo WHERE re_~@byo@~_front.re_fsbo.firstExtractionDate > CURDATE()) AS frontendUniqueCount, (SELECT COUNT(*) FROM re_~@byo@~_front.re_fsbo WHERE re_~@byo@~_front.re_fsbo.firstExtractionDate > CURDATE() AND (stage = '0' OR stage = '2' OR stage like '1%')) AS frontendProcessableCount, (SELECT COUNT(*) FROM re_~@byo@~_back.re_fsbo WHERE re_~@byo@~_back.re_fsbo.firstExtractionDate > CURDATE()) AS stagerCount, (SELECT COUNT(*) FROM re_~@byo@~_back.re_fsbo_complete WHERE re_~@byo@~_back.re_fsbo_complete.firstExtractionDate > CURDATE()) AS completeCount, (SELECT COUNT(*) FROM re_~@byo@~_back.re_fsbo_complete WHERE re_~@byo@~_back.re_fsbo_complete.firstExtractionDate > CURDATE() AND (Area_Name IS NULL OR Area_Name<>'Other')) AS validExport FROM DUAL"
      },
      "data": {
        "title": "row.names",
        "dataset": [
          {
            "name": "# of Ads",
            "from": "row.0"
          }
        ]
      }
    },

    {
      "name": "expototal",
      "type": "line",
      "params": {
        "required": [
          {
            "name": "byo",
            "mappings": [
              {
                "input": "frbo",
                "mapto": "2"
              },
              {
                "input": ".*?",
                "mapto": "1"
              }
            ]
          }
        ],
        "optional": [
          {
            "name": "days",
            "mappings": [
              {
                "input": "\\d+",
                "mapto": "LIMIT ~@input@~"
              },
              {
                "input": "X",
                "mapto": ""
              }
            ],
            "defaultValue": "LIMIT 30"
          }
        ]
      },
      "query": {
        "sql": "SELECT DATE_FORMAT(expo.date, '%d %M %Y'), breakdown.complete FROM re_stat.export_total AS expo INNER JOIN re_stat.export_type ON expo.type_id = export_type.id INNER JOIN re_stat.export_breakdown AS breakdown ON expo.breakdown_id = breakdown.id WHERE expo.type_id = ~@byo@~ ORDER BY date DESC ~@days@~"
      },
      "data": {
        "title": "column.0",
        "dataset": [
          {
            "name": "Ads Exported",
            "from": "column.1"
          }
        ]
      }
    }

  ]
}